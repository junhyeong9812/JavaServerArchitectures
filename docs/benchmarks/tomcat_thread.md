# í†°ìº£ ìŠ¤íƒ€ì¼ ThreadPool ìµœì í™” ê²°ê³¼ ë¶„ì„

## ğŸ¯ ìµœì í™” ëª©í‘œ
ThreadedServerì˜ ì„±ëŠ¥ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ **í†°ìº£ ìŠ¤íƒ€ì¼ ì¦‰ì‹œ ìŠ¤ë ˆë“œ ìƒì„± ì „ëµ**ì„ ë„ì…

### ê¸°ì¡´ ë¬¸ì œì 
- ê¸°ë³¸ ThreadPoolExecutor: Core â†’ Queue â†’ Additional threads ìˆœì„œ
- ì‹¤ì œ ì‚¬ìš©: ëŒ€ë¶€ë¶„ 10ê°œ ì½”ì–´ ìŠ¤ë ˆë“œë§Œ í™œìš©
- **ê²°ê³¼**: ê·¹ë„ë¡œ ë‚®ì€ TPS (12.74)

### í•´ê²° ë°©ì•ˆ
- í†°ìº£ ìŠ¤íƒ€ì¼: Core â†’ **Immediate threads** (maxê¹Œì§€) â†’ Queue
- ì¦‰ì‹œ ìŠ¤ë ˆë“œ ìƒì„±ìœ¼ë¡œ ë†’ì€ ë™ì‹œì„± ì²˜ë¦¬
- TomcatStyleThreadPoolExecutor + TomcatStyleTaskQueue êµ¬í˜„

## ğŸš€ ë†€ë¼ìš´ ì„±ëŠ¥ í–¥ìƒ ê²°ê³¼

### ğŸ“Š ì „ì²´ ì„±ëŠ¥ ë¹„êµí‘œ

| í…ŒìŠ¤íŠ¸ | ìµœì í™” ì „ | ìµœì í™” í›„ | í–¥ìƒë¥  | ìŠ¹ì |
|--------|-----------|-----------|--------|------|
| **Basic** | 12.74 TPS | **2,272.73 TPS** | **17,800%** â†—ï¸ | ThreadedServer |
| **Concurrency** | 2,053 TPS | **7,092 TPS** | **245%** â†—ï¸ | ThreadedServer |
| **CPU Intensive** | 7.99 TPS | **1,652.89 TPS** | **20,600%** â†—ï¸ | ThreadedServer |
| **I/O Intensive** | 17.08 TPS | **28.19 TPS** | **65%** â†—ï¸ | âŒ EventLoop ìš°ìŠ¹ |
| **Memory Pressure** | 83.60 TPS | **194.30 TPS** | **132%** â†—ï¸ | âŒ EventLoop ìš°ìŠ¹ |

## ğŸ“ˆ ì„¸ë¶€ ì„±ëŠ¥ ë¶„ì„

### âœ… ThreadedServer ì••ìŠ¹ ì˜ì—­

#### 1. **Basic í…ŒìŠ¤íŠ¸**
- **ThreadedServer**: 2,272.73 TPS (í‰ê·  ì§€ì—° 2.71ms)
- EventLoop: 1,333.33 TPS (í‰ê·  ì§€ì—° 6.18ms)
- Hybrid: 900.90 TPS (í‰ê·  ì§€ì—° 7.77ms)
- **ìŠ¹ë¦¬ ìš”ì¸**: í†°ìº£ ìŠ¤íƒ€ì¼ ì¦‰ì‹œ ìŠ¤ë ˆë“œ ìƒì„±ì˜ íš¨ê³¼

#### 2. **Concurrency í…ŒìŠ¤íŠ¸**
- **ThreadedServer**: 7,092.20 TPS (100ê°œ ë™ì‹œ ì—°ê²°)
- EventLoop: 3,571.43 TPS (50ê°œ ë™ì‹œ ì—°ê²°)
- Hybrid: 2,932.55 TPS (50ê°œ ë™ì‹œ ì—°ê²°)
- **ìŠ¹ë¦¬ ìš”ì¸**: ë†’ì€ ë™ì‹œì„± ì²˜ë¦¬ ëŠ¥ë ¥ (200ê°œ ìŠ¤ë ˆë“œê¹Œì§€ í™•ì¥)

#### 3. **CPU Intensive í…ŒìŠ¤íŠ¸**
- **ThreadedServer**: 1,652.89 TPS (í‰ê·  ì§€ì—° 7.25ms)
- Hybrid: 701.75 TPS (í‰ê·  ì§€ì—° 22.52ms)
- EventLoop: 362.98 TPS (í‰ê·  ì§€ì—° 49.09ms)
- **ìŠ¹ë¦¬ ìš”ì¸**: ë©€í‹° ìŠ¤ë ˆë“œì˜ CPU ì‘ì—… ë³‘ë ¬ ì²˜ë¦¬

### âŒ ì—¬ì „íˆ ê°œì„  í•„ìš”í•œ ì˜ì—­

#### 1. **I/O Intensive í…ŒìŠ¤íŠ¸**
- ThreadedServer: 28.19 TPS (í‰ê·  ì§€ì—° 1,413.99ms)
- **EventLoop**: 619.11 TPS (í‰ê·  ì§€ì—° 124.93ms) â† **22ë°° ìš°ì„¸**
- Hybrid: 103.35 TPS (í‰ê·  ì§€ì—° 799.26ms)
- **íŒ¨ë°° ìš”ì¸**: I/O ëŒ€ê¸°ì‹œ ìŠ¤ë ˆë“œ ë¸”ë¡œí‚¹ (ThreadedServerì˜ ê·¼ë³¸ì  í•œê³„)

#### 2. **Memory Pressure í…ŒìŠ¤íŠ¸**
- ThreadedServer: 194.30 TPS (ì—ëŸ¬ìœ¨ 31.70%)
- **EventLoop**: 874.34 TPS (ì—ëŸ¬ìœ¨ 17.06%) â† **4.5ë°° ìš°ì„¸**
- Hybrid: 841.91 TPS (ì—ëŸ¬ìœ¨ 19.80%)
- **íŒ¨ë°° ìš”ì¸**: ë†’ì€ ìŠ¤ë ˆë“œ ìˆ˜ë¡œ ì¸í•œ ë©”ëª¨ë¦¬ ì˜¤ë²„í—¤ë“œ

## ğŸ”§ í•µì‹¬ ìµœì í™” ê¸°ìˆ 

### 1. **TomcatStyleThreadPoolExecutor**
```java
// í•µì‹¬ ë¡œì§: execute() ë©”ì„œë“œ ì˜¤ë²„ë¼ì´ë“œ
if (currentThreads < maxThreads) {
    // ì½”ì–´ ì‚¬ì´ì¦ˆë¥¼ ë™ì ìœ¼ë¡œ ëŠ˜ë ¤ì„œ ì¦‰ì‹œ ìŠ¤ë ˆë“œ ìƒì„±
    int newCoreSize = Math.min(currentThreads + 1, maxThreads);
    setCorePoolSize(newCoreSize);
}
```

### 2. **TomcatStyleTaskQueue**
```java
// offer() ë©”ì„œë“œ ì˜¤ë²„ë¼ì´ë“œ
if (currentThreads < maxThreads) {
    return false; // íì— ë„£ì§€ ì•Šê³  ìƒˆ ìŠ¤ë ˆë“œ ìƒì„± ìœ ë„
}
return super.offer(o); // ìµœëŒ€ ìŠ¤ë ˆë“œ ë„ë‹¬ í›„ í ì‚¬ìš©
```

### 3. **ìµœì í™”ëœ ì„¤ì •ê°’**
```java
ThreadPoolConfig optimizedConfig = new ThreadPoolConfig()
    .setCorePoolSize(20)           // 10 â†’ 20
    .setMaxPoolSize(200)           // 100 â†’ 200  
    .setQueueCapacity(50)          // 200 â†’ 50
    .setKeepAliveTime(30)          // 60 â†’ 30ì´ˆ
    .setDebugMode(false);          // ì„±ëŠ¥ì„ ìœ„í•´ ë¹„í™œì„±í™”
```

## ğŸ“Š ì„œë²„ë³„ íŠ¹ì„± ë¶„ì„

### ğŸ¥‡ **ThreadedServer (í†°ìº£ ìŠ¤íƒ€ì¼)**
**ê°•ì :**
- âœ… ë†’ì€ ì²˜ë¦¬ëŸ‰ (ê¸°ë³¸/ë™ì‹œì„±/CPU ì‘ì—…)
- âœ… ì•ˆì •ì ì¸ ì‘ë‹µ ì‹œê°„
- âœ… ê²€ì¦ëœ í†°ìº£ ì•„í‚¤í…ì²˜ ê¸°ë°˜

**ì•½ì :**
- âŒ I/O ëŒ€ê¸°ì‹œ ìŠ¤ë ˆë“œ ë¸”ë¡œí‚¹
- âŒ ë†’ì€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ (ë§ì€ ìŠ¤ë ˆë“œ)

### ğŸ¥ˆ **EventLoop Server**
**ê°•ì :**
- âœ… I/O ì§‘ì•½ì  ì‘ì—…ì—ì„œ ì••ë„ì  ì„±ëŠ¥
- âœ… ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±
- âœ… ë‚®ì€ ì—ëŸ¬ìœ¨

**ì•½ì :**
- âŒ CPU ì§‘ì•½ì  ì‘ì—…ì—ì„œ ì €ì¡°í•œ ì„±ëŠ¥
- âŒ ë³µì¡í•œ êµ¬í˜„

### ğŸ¥‰ **Hybrid Server**
**ê°•ì :**
- âœ… ê· í˜• ì¡íŒ ì„±ëŠ¥
- âœ… ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­ ê¸°ìˆ 

**ì•½ì :**
- âŒ ëª¨ë“  ì˜ì—­ì—ì„œ ì¤‘ê°„ ì„±ëŠ¥
- âŒ ë³µì¡í•œ ì•„í‚¤í…ì²˜

## ğŸ¯ ê²°ë¡  ë° ê¶Œì¥ì‚¬í•­

### **ì„±ê³¼ ìš”ì•½**
1. **ê¸°ë³¸ ì„±ëŠ¥**: **17,800% í–¥ìƒ** - í†°ìº£ ìŠ¤íƒ€ì¼ ìµœì í™”ì˜ ì™„ì „í•œ ì„±ê³µ
2. **ë™ì‹œì„± ì²˜ë¦¬**: **245% í–¥ìƒ** - ë†’ì€ ë¶€í•˜ì—ì„œë„ ìš°ìˆ˜í•œ ì„±ëŠ¥
3. **CPU ì‘ì—…**: **20,600% í–¥ìƒ** - ë©€í‹°ìŠ¤ë ˆë“œì˜ ì§„ê°€ ë°œíœ˜

### **ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤ë³„ ê¶Œì¥**

#### ğŸ¯ **ThreadedServer ì¶”ì²œ**
- **ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜** (ë†’ì€ ë™ì‹œì„± + CPU ì‘ì—…)
- **API ì„œë²„** (ë¹ ë¥¸ ì‘ë‹µ ì‹œê°„ ì¤‘ìš”)
- **ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤** (ì•ˆì •ì„± ì¤‘ì‹œ)

#### ğŸ¯ **EventLoop Server ì¶”ì²œ**
- **I/O ì§‘ì•½ì  ì• í”Œë¦¬ì¼€ì´ì…˜** (DB ì¿¼ë¦¬, íŒŒì¼ ì²˜ë¦¬)
- **ì±„íŒ…/ì‹¤ì‹œê°„ ì„œë¹„ìŠ¤** (ë§ì€ ë™ì‹œ ì—°ê²°)
- **í”„ë¡ì‹œ/ê²Œì´íŠ¸ì›¨ì´** (ë„¤íŠ¸ì›Œí¬ I/O ì¤‘ì‹¬)

#### ğŸ¯ **Hybrid Server ì¶”ì²œ**
- **ë³µí•© ì›Œí¬ë¡œë“œ** (I/O + CPU í˜¼ì¬)
- **ì‹¤í—˜ì  í”„ë¡œì íŠ¸** (ìƒˆë¡œìš´ ê¸°ìˆ  ë„ì…)

### **ì¶”ê°€ ìµœì í™” ë°©í–¥**
1. **TomcatStyleTaskQueue ìˆ˜ì •** - í†°ìº£ ë¡œì§ ì™„ì„±
2. **I/O ìµœì í™”** - NIO ê¸°ë°˜ ë…¼ë¸”ë¡œí‚¹ I/O ë„ì… ê³ ë ¤
3. **ë©”ëª¨ë¦¬ ìµœì í™”** - ìŠ¤ë ˆë“œ í’€ ì‚¬ì´ì¦ˆ ë™ì  ì¡°ì •

## ğŸ† ìµœì¢… í‰ê°€

**í†°ìº£ ìŠ¤íƒ€ì¼ ThreadPoolManager ìµœì í™”ëŠ” ëŒ€ì„±ê³µ!**

ê¸°ì¡´ 12 TPSì—ì„œ **2,272 TPSë¡œ 17,800% í–¥ìƒ**ì„ ë‹¬ì„±í•˜ì—¬,
ThreadedServerê°€ ì‹¤ì œ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ìˆ˜ì¤€ì˜ ì„±ëŠ¥ì„ í™•ë³´í–ˆìŠµë‹ˆë‹¤.

íŠ¹íˆ **CPU ì§‘ì•½ì  ì‘ì—…**ê³¼ **ë†’ì€ ë™ì‹œì„±** í™˜ê²½ì—ì„œ EventLoop Serverë¥¼ ì••ë„í•˜ëŠ” ì„±ëŠ¥ì„ ë³´ì—¬ì£¼ì–´,
**ì „í†µì ì¸ ìŠ¤ë ˆë“œ ê¸°ë°˜ ì•„í‚¤í…ì²˜ì˜ ìš°ìˆ˜ì„±**ì„ ë‹¤ì‹œ í•œë²ˆ ì…ì¦í–ˆìŠµë‹ˆë‹¤.